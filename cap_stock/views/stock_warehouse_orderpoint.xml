<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_warehouse_orderpoint_tree_editable_minmax_formula" model="ir.ui.view">
        <field name="name">view_warehouse_orderpoint_tree_editable_minmax_formula</field>
        <field name="model">stock.warehouse.orderpoint</field>
        <field name="inherit_id" ref="stock.view_warehouse_orderpoint_tree_editable"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='route_id']" position="after">
                <field name="purchase_order_cost_var" optional="hide" groups="cap_stock.edit_orderpoint_python, base.group_system"/>
                <field name="inventory_maint_cost_var" optional="hide" groups="cap_stock.edit_orderpoint_python, base.group_system"/>
                <field name="period_days" optional="hide" groups="cap_stock.edit_orderpoint_python, base.group_system"/>
                <field name="sales_order_line_volume" optional="hide" />
                <field name="formula_type" optional="hide" groups="cap_stock.edit_orderpoint_python, base.group_system"/>
                <field name="python_code" widget="code" options="{'mode': 'python'}" optional="hide" invisible="formula_type != 'python_code'" groups="cap_stock.edit_orderpoint_python, base.group_system"/>
            </xpath>
            <xpath expr="//tree" position="inside">
                <field name="last_min_max_run_date" readonly="True" string="M/M Last Run" optional="hide"/>
            </xpath>
            <xpath expr="//button[@name='action_replenish']" position="before">
                <field name="show_run_min_max" column_invisible="True" />
                <button name="run_min_max" type="object" title="Recalc" string="Recalc M/M" icon="fa-calculator" invisible="not show_run_min_max" context="{'active_id':id}"/>
                <button name="edit_min_max_formula" type="object" title="Edit Formula" string="Edit Python" icon="fa-refresh" groups="cap_stock.edit_orderpoint_python, base.group_system"/>
            </xpath>
        </field>
    </record>
    <record id="view_warehouse_orderpoint_form_minmax_formula" model="ir.ui.view">
        <field name="name">view_warehouse_orderpoint_form_minmax_formula</field>
        <field name="model">stock.warehouse.orderpoint</field>
        <field name="inherit_id" ref="stock.view_warehouse_orderpoint_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="inside">
                <notebook>
                    <page string="Reordering Rule Engine" name="reorder_rules">
                        <group groups="cap_stock.edit_orderpoint_python, base.group_system">
                            <group name="reorder_container">
                                <group name="reorder_left_group">
                                    <field name="formula_type"/>
                                    <field name="purchase_order_cost_var" />
                                    <field name="inventory_maint_cost_var" />
                                    <field name="period_days" />
                                </group>
                                <group name="reorder_right_group">
                                    <field name="sales_order_line_volume" />
                                    <field name="standard_price" />
                                    <field name="last_min_max_run_date" readonly="True" force_save="True"/>
                                    <button name="run_min_max" colspan="2" type="object" title="Recalc" string="Recalc M/M" class="btn oe_highlight m-2" icon="fa-calculator" context="{'active_id':id}"/>
                                </group>
                            </group>
                            <field name="python_code" widget="code" options="{'mode': 'python'}" class="mt-4"/>
                            <div class="mt-4">
                                <p><strong>How to use this tool:</strong></p>
                                <p>
                                    The reordering rules, when created, will load their defaults based on the warehouse configuration. 
                                    Several default parameters are available to be used when the formula type is set to Python. 
                                    <br />
                                    These include:
                                </p>
                                <ul>
                                    <li><strong>order_cost_fixed</strong></li>
                                    <li><strong>inventory_main_cost</strong></li>
                                    <li><strong>period_days</strong></li>
                                    <li><strong>unit_cost</strong></li>
                                    <li><strong>demo_sales_volume</strong></li>
                                    <li><strong>Math</strong> - (the standard Python math library to gain access to functions like sqrt())</li>
                                </ul>
                                <p>
                                    The typical 'Server Action' objects are also available to be used with the exception of 'records' since that could create an infinite loop.
                                    <br />
                                    These include:
                                </p>
                                <ul>
                                    <li><strong>uid</strong></li>
                                    <li><strong>user</strong></li>
                                    <li><strong>time</strong></li>
                                    <li><strong>datetime</strong></li>
                                    <li><strong>dateutil</strong></li>
                                    <li><strong>timezone</strong></li>
                                    <li><strong>float_compare</strong></li>
                                    <li><strong>b64encode</strong></li>
                                    <li><strong>b64decode</strong></li>
                                    <li><strong>Command</strong></li>
                                    <li><strong>model</strong></li>
                                    <li><strong>record</strong></li>
                                    <li><strong>_logger</strong></li>
                                    <li><strong>log</strong></li>
                                </ul>
                                <p>
                                    A simulation of the formula can be tested with the code editor here by utilizing the 'Demo Sales Volume' and 'Demo Cost Unit'. 
                                    When passed down to the reordering rule, <strong>sales_volume</strong> will search Sales History and <strong>unit_cost</strong> will search from the product.
                                    <br />
                                    Two values should be set in order to have the dynamic calculation work: <strong>min_qty</strong> and <strong>max_qty</strong>.
                                    <br />
                                    If these parameters are not found, then 0 will be set instead.
                                </p>
                            </div>
                        </group>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>
</odoo>
